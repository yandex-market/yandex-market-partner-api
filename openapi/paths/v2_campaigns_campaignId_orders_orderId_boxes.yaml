put:
  tags:
    - orders
    - fbs
    - express
    - dbs
  x-auth-scopes:
    - all-methods
    - inventory-and-order-processing
  operationId: setOrderBoxLayout
  summary: Подготовка заказа
  description: "{% include notitle [:no-translate[access]](../../_auto/method_scopes/setOrderBoxLayout.md) %}\n\n{% note tip \"Подходит и для DBS\" %}\n\nЗапрос предназначен для работы с FBS-заказами, но вы можете использовать его для обработки DBS-заказов, если это удобно.\n\n{% endnote %}\n\nПозволяет выполнить три операции:\n\n* передать Маркету информацию о распределении товаров по коробкам;\n* передать Маркету коды маркировки для товаров;\n* удалить товар из заказа, если его не оказалось на складе.\n\nЕсли нужно что-то поправить в переданных данных, просто повторите запрос — это можно делать сколько угодно раз до перевода заказа в статус **Готов к отгрузке**. ⚠️ Если вы меняете раскладку уже после печати и расклейки ярлыков, не забудьте перепечатать их и наклеить заново.\n\n{% cut \"Как передать информацию о распределении товаров\" %}\n\nВ этом запросе вам нужно передать Маркету список коробок и указать, какие именно товары лежат в каждой из них. Коробки могут быть двух типов:\n\n* **Содержащие товары целиком.** Такая коробка может содержать сколько угодно единиц любых товаров.\n\n* **Содержащие часть товара.** Такие коробки содержат по одной части одного товара. Например, одна содержит внешний блок кондиционера, а другая — внутренний блок.\n\n⚠️ Одна коробка не может содержать и товары целиком, и части товаров.\n\n{% endcut %}\n\n{% cut \"Как передавать коды маркировки и получать статус их проверки\" %}\n\n{% note info \"Маркировка товаров в системе [:no-translate[«Честный ЗНАК»]](https://честныйзнак.рф/) необязательна для заказов от физических лиц\" %}\n\nДля заказов от бизнеса все еще нужно передавать коды маркировки.\n\n{% endnote %}\n\nЕсли в заказе есть товары, подлежащие маркировке, в запросе нужно передать соответствующие уникальные коды. [Что такое маркировка](https://yandex.ru/support/marketplace/orders/cz.html)\n\nПринимаются коды следующих типов:\n\n* Коды в системе [:no-translate[«Честный ЗНАК»]](https://честныйзнак.рф/) или [:no-translate[«ASL BELGISI»]](https://aslbelgisi.uz) (для продавцов :no-translate[Market Yandex Go]).\n* УИН для ювелирных изделий.\n* РНПТ и ГТД для импортных прослеживаемых товаров.\n\nДля каждой позиции в заказе, требующей маркировки, нужно передать список кодов — по одному для каждой единицы товара. Например, если в заказе две пары тапочек и одна пара туфель, получится список из двух кодов для первой позиции и список из одного кода для второй.\n\nЕсли товар едет в нескольких коробках, код маркировки нужно передать для каждой из них.\n\n{% note warning \"Если вы работаете по модели FBS, EXPRESS\" %}\n\nДля заказов, в которых есть ювелирные изделия или товары с маркировкой в системе :no-translate[«Честный ЗНАК»], перевод в статус `READY_TO_SHIP` становится доступен, только когда:\n\n1. Вы передадите Маркету :no-translate[УИНы] по каждому ювелирному изделию в заказе и коды в системе :no-translate[«Честный ЗНАК»] по всем товарам в заказе, для которых обязательна эта маркировка.\n2. Все коды маркировки успешно пройдут проверку. [Как получить статусы проверки](../../reference/orders/getOrderIdentifiersStatus.md)\n\n⚠️ Неуспешный статус проверки кодов маркировки в системе [:no-translate[«Честный ЗНАК»]](https://честныйзнак.рф/) не блокирует перевод заказа в статус `READY_TO_SHIP` до 28 ноября 2025 года.\n\n{% endnote %}\n\n{% endcut %}\n\n{% cut \"Как удалить товар из заказа\" %}\n\nЧтобы удалить товар из заказа:\n\n1. Добавьте в запрос `allowRemove: true`.\n2. Передайте распределение по коробкам без товара, который нужно удалить.\n\n{% note warning \"Удаление нельзя отменить\" %}\n\nЭта операция необратима: покупатель сразу получит уведомление, а состав заказа изменится.\n\n{% endnote %}\n\nЧтобы удалить позицию целиком, не передавайте соответствующий `OrderBoxLayoutItemDTO`. Чтобы уменьшить количество товара, передайте уменьшенное значение в поле `fullCount`.\n\nНельзя удалить или уменьшить количество товара, если он:\n\n* добавлен по акции;\n* составляет 99% стоимости заказа;\n* единственный товар в заказе.\n\nЕсли вы не можете отгрузить такой товар, отмените заказ. Для этого отправьте запрос методом [PUT\_v2/campaigns/{campaignId}/orders/{orderId}/status](../../reference/orders/updateOrderStatus.md) и передайте статус заказа `CANCELLED` с причиной отмены `SHOP_FAILED`.\n\n{% endcut %}\n\n{% note info \"Увеличить заказ нельзя\" %}\n\nС помощью запроса нельзя увеличить количество одинаковых товаров, добавить новые товары в заказ или заменить один товар другим.\n\n{% endnote %}\n\n## Примеры\n\n{% cut \"Товар умещается в коробку\" %}\n\nВот как будет выглядеть запрос, если в одной коробке едут:\n\n  * три единицы одного товара, требующего маркировки;\n  * одна единица другого товара, не требущего маркировки.\n\n  ```json translate=no\n  {\n      \"boxes\": [\n          {\n              \"items\": [\n                  {\n                      \"id\": 123456,\n                      \"fullCount\": 3,\n                      \"instances\": [\n                          {\n                              \"cis\": \"01030410947874432155Qbag!\\u001d93Zjqw\"\n                          },\n                          {\n                              \"cis\": \"010304109478gftJ14545762!\\u001dhGt264\"\n                          },\n                          {\n                              \"cis\": \"010304109478fRs28323ks23!\\u001dhet201\"\n                          }\n                      ]\n                  },\n                  {\n                      \"id\": 654321,\n                      \"fullCount\": 1\n                  }\n              ]\n          }\n      ]\n  }\n  ```\n\n{% endcut %}\n\n{% cut \"Товар едет в разных коробках\" %}\n\nВот как будет выглядеть запрос, если товар едет в двух коробках:\n\n  ```json translate=no\n  {\n      \"boxes\": [\n          {\n              \"items\": [\n                  {\n                      \"id\": 123456,\n                      \"partialCount\": {\n                          \"current\": 1,\n                          \"total\": 2\n                      },\n                      \"instances\": [\n                          {\n                              \"cis\": \"01030410947874432155Qbag!\\u001d93Zjqw\"\n                          }\n                      ]\n                  }\n              ]\n          },\n          {\n              \"items\": [\n                  {\n                      \"id\": 123456,\n                      \"partialCount\": {\n                          \"current\": 2,\n                          \"total\": 2\n                      },\n                      \"instances\": [\n                          {\n                              \"cis\": \"01030410947874432155Qbag!\\u001d93Zjqw\"\n                          }\n                      ]\n                  }\n              ]\n          }\n      ]\n  }\n  ```\n\n{% endcut %}\n\n{% cut \"Одинаковые товары, где каждый едет в нескольких коробках\" %}\n\nВот как будет выглядеть запрос, если каждый из двух одинаковых товаров едет в двух коробках:\n\n  ```json translate=no\n  {\n      \"boxes\": [\n          {\n              \"items\": [\n                  {\n                      \"id\": 123456,\n                      \"partialCount\": {\n                          \"current\": 1,\n                          \"total\": 2\n                      },\n                      \"instances\": [\n                          {\n                              \"cis\": \"01030410947874432155Qbag!\\u001d93Zjqw\"\n                          }\n                      ]\n                  }\n              ]\n          },\n          {\n              \"items\": [\n                  {\n                      \"id\": 123456,\n                      \"partialCount\": {\n                          \"current\": 2,\n                          \"total\": 2\n                      },\n                      \"instances\": [\n                          {\n                              \"cis\": \"01030410947874432155Qbag!\\u001d93Zjqw\"\n                          }\n                      ]\n                  }\n              ]\n          },\n          {\n              \"items\": [\n                  {\n                      \"id\": 123456,\n                      \"partialCount\": {\n                          \"current\": 1,\n                          \"total\": 2\n                      },\n                      \"instances\": [\n                          {\n                              \"cis\": \"01030410947874432155Qbag!\\u001d93Zjqw\"\n                          }\n                      ]\n                  }\n              ]\n          },\n          {\n              \"items\": [\n                  {\n                      \"id\": 123456,\n                      \"partialCount\": {\n                          \"current\": 2,\n                          \"total\": 2\n                      },\n                      \"instances\": [\n                          {\n                              \"cis\": \"01030410947874432155Qbag!\\u001d93Zjqw\"\n                          }\n                      ]\n                  }\n              ]\n          }\n      ]\n  }\n  ```\n\n{% endcut %}\n\n|**⚙️ Лимит:** 100 000 запросов в час|\n|-|\n"
  parameters:
    - $ref: ../components/parameters/CampaignId.yaml
    - $ref: ../components/parameters/OrderId.yaml
  requestBody:
    required: true
    content:
      application/json:
        schema:
          $ref: ../components/schemas/SetOrderBoxLayoutRequest.yaml
  responses:
    '200':
      description: >
        В ответ придет переданная раскладка с идентификаторами коробок — они
        понадобятся для запроса ярлыков.
      content:
        application/json:
          schema:
            $ref: ../components/schemas/SetOrderBoxLayoutResponse.yaml
    '400':
      $ref: ../components/responses/400.yaml
    '401':
      $ref: ../components/responses/401.yaml
    '403':
      $ref: ../components/responses/403.yaml
    '404':
      $ref: ../components/responses/404.yaml
    '420':
      $ref: ../components/responses/420.yaml
    '500':
      $ref: ../components/responses/500.yaml
